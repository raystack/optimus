"use strict";(self.webpackChunkoptimus=self.webpackChunkoptimus||[]).push([[2492],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>g});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var l=n.createContext({}),c=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(r),m=a,g=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return r?n.createElement(g,i(i({ref:t},p),{},{components:r})):n.createElement(g,i({ref:t},p))}));function g(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=r[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},281:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var n=r(7462),a=(r(7294),r(3905));const o={id:"create-bigquery-external-table",title:"Create bigquery external table"},i=void 0,s={unversionedId:"guides/create-bigquery-external-table",id:"guides/create-bigquery-external-table",title:"Create bigquery external table",description:"A BigQuery external table is a data source stored in external storage that you can query directly",source:"@site/docs/guides/create-bigquery-external-table.md",sourceDirName:"guides",slug:"/guides/create-bigquery-external-table",permalink:"/optimus/docs/guides/create-bigquery-external-table",draft:!1,editUrl:"https://github.com/odpf/optimus/edit/master/docs/docs/guides/create-bigquery-external-table.md",tags:[],version:"current",lastUpdatedBy:"Arinda Arif",lastUpdatedAt:1680125812,formattedLastUpdatedAt:"Mar 29, 2023",frontMatter:{id:"create-bigquery-external-table",title:"Create bigquery external table"},sidebar:"docsSidebar",previous:{title:"Create bigquery view",permalink:"/optimus/docs/guides/create-bigquery-view"},next:{title:"Organising specifications",permalink:"/optimus/docs/guides/organising-specifications"}},l={},c=[{value:"Creating external table with Optimus",id:"creating-external-table-with-optimus",level:3},{value:"Creating external table over REST",id:"creating-external-table-over-rest",level:3},{value:"Creating external table over GRPC",id:"creating-external-table-over-grpc",level:3}],p={toc:c},u="wrapper";function d(e){let{components:t,...r}=e;return(0,a.kt)(u,(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"A BigQuery external table is a data source stored in external storage that you can query directly\nin BigQuery the same way you query a table. You can specify the schema of the external table when\nit is created. At the moment only Google Drive source with Google Sheets format is supported."),(0,a.kt)("p",null,"There are 3 ways to create an external table:"),(0,a.kt)("h3",{id:"creating-external-table-with-optimus"},"Creating external table with Optimus"),(0,a.kt)("p",null,"Supported datastore can be selected by calling"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"optimus resource create\n")),(0,a.kt)("p",null,"Optimus will request a resource name which should be unique across whole datastore.\nAll resource specification contains a name field which conforms to a fixed format.\nIn case of bigquery external table, format should be\n",(0,a.kt)("inlineCode",{parentName:"p"},"projectname.datasetname.tablename"),".\nAfter the name is provided, ",(0,a.kt)("inlineCode",{parentName:"p"},"optimus")," will create a file in configured datastore\ndirectory. Open the created specification file and add additional spec details\nas follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'version: 1\nname: temporary-project.optimus-playground.first_table\ntype: external_table\nlabels:\n  usage: testexternaltable\n  owner: optimus\nspec:\n  description: "example description"\n  schema:\n    - name: colume1\n      type: INTEGER\n    - name: colume2\n      type: TIMESTAMP\n      description: "example field 2"\n  source:\n    type: google_sheets\n    uris:\n      - https://docs.google.com/spreadsheets/d/spreadsheet_id\n    config:\n      range: Sheet1!A1:B4 # Range of data to be ingested in format of [Sheet Name]![Cell Range]\n      skip_leading_rows: 1 # Row of records to skip\n')),(0,a.kt)("p",null,"This will add labels, description, schema, and external table source specification depending\non the type of external table."),(0,a.kt)("p",null,"Optimus generates specification on the root directory inside datastore with directory\nname same as resource name, although you can change directory name to whatever you\nfind fit to organize resources. Directory structures inside datastore doesn't\nmatter as long as ",(0,a.kt)("inlineCode",{parentName:"p"},"resource.yaml")," is in a unique directory."),(0,a.kt)("p",null,"For example following is a valid directory structure"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"./\n./bigquery/temporary-project/optimus-playground/resource.yaml\n./bigquery/temporary-project/optimus-playground/first_external_table/resource.yaml\n")),(0,a.kt)("h3",{id:"creating-external-table-over-rest"},"Creating external table over REST"),(0,a.kt)("p",null,"Optimus exposes Create/Update rest APIS"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Create: POST /api/v1beta1/project/{project_name}/namespace/{namespace}/datastore/{datastore_name}/resource\nUpdate: PUT /api/v1beta1/project/{project_name}/namespace/{namespace}/datastore/{datastore_name}/resource\nRead: GET /api/v1beta1/project/{project_name}/namespace/{namespace}/datastore/{datastore_name}/resource/{resource_name}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "resource": {\n    "version": 1,\n    "name": "temporary-project.optimus-playground.first_table",\n    "datastore": "bigquery",\n    "type": "external_table",\n    "labels": {\n      "usage": "testexternaltable",\n      "owner": "optimus"\n    },\n    "spec": {\n      "description": "example description",\n      "schema": [\n        {\n          "name": "column1",\n          "type": "INTEGER"\n        },\n        {\n          "name": "column2",\n          "type": "TIMESTAMP",\n          "description": "example description",\n          "mode": "required"\n        }\n      ],\n      "source": {\n        "type": "google_sheets",\n        "uris": ["https://docs.google.com/spreadsheets/d/spreadsheet_id"],\n        "config": {\n          "range": "Sheet1!A1:B4",\n          "skip_leading_rows": 1\n        }\n      }\n    }\n  }\n}\n')),(0,a.kt)("h3",{id:"creating-external-table-over-grpc"},"Creating external table over GRPC"),(0,a.kt)("p",null,"Optimus in RuntimeService exposes an RPC"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-protobuf"},"rpc CreateResource(CreateResourceRequest) returns (CreateResourceResponse) {}\n\nmessage CreateResourceRequest {\n    string project_name = 1;\n    string datastore_name = 2;\n    ResourceSpecification resource = 3;\n    string namespace = 4;\n}\n")),(0,a.kt)("p",null,"Function payload should be self-explanatory other than the struct ",(0,a.kt)("inlineCode",{parentName:"p"},"spec")," part which\nis very similar to how json representation look."),(0,a.kt)("p",null,"Spec will use ",(0,a.kt)("inlineCode",{parentName:"p"},"structpb")," struct created with ",(0,a.kt)("inlineCode",{parentName:"p"},"map[string]interface{}"),"\nFor example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'map[string]interface{\n    "description": "example description",\n    "schema": []interface{\n        map[string]interface{\n            "name": "colume1",\n            "type": "integer"\n        },\n        map[string]interface{\n            "name": "colume2",\n            "type": "timestamp"\n            "description": "some description",\n            "mode": "required"\n        },\n    },\n    "source": map[string]interface{\n        "type": "google_sheets",\n        "uris": []string{"https://docs.google.com/spreadsheets/d/spreadsheet_id"},\n        "config": map[string]interface{\n            "range": "Sheet1!A1:B4",\n            "skip_leading_rows": 1\n        }\n    },\n}\n')))}d.isMDXComponent=!0}}]);