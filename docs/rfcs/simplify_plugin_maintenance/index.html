<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-rfcs/simplify_plugin_maintenance">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">simplify_plugin_maintenance | Optimus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://odpf.github.io/optimus/docs/rfcs/simplify_plugin_maintenance"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="simplify_plugin_maintenance | Optimus"><meta data-rh="true" name="description" content="- Feature Name: Simplify Plugins"><meta data-rh="true" property="og:description" content="- Feature Name: Simplify Plugins"><link data-rh="true" rel="icon" href="/optimus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://odpf.github.io/optimus/docs/rfcs/simplify_plugin_maintenance"><link data-rh="true" rel="alternate" href="https://odpf.github.io/optimus/docs/rfcs/simplify_plugin_maintenance" hreflang="en"><link data-rh="true" rel="alternate" href="https://odpf.github.io/optimus/docs/rfcs/simplify_plugin_maintenance" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/optimus/blog/rss.xml" title="Optimus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/optimus/blog/atom.xml" title="Optimus Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RSCK0YREFM"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RSCK0YREFM",{anonymize_ip:!0})</script><link rel="stylesheet" href="/optimus/assets/css/styles.84bfa261.css">
<link rel="preload" href="/optimus/assets/js/runtime~main.35534b05.js" as="script">
<link rel="preload" href="/optimus/assets/js/main.0c2553fe.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#222;color:#eee" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️ If you like Optimus, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/odpf/optimus">GitHub</a>! ⭐</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/optimus/"><div class="navbar__logo"><img src="/optimus/img/logo.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/optimus/img/logo.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Optimus</b></a><a class="navbar__item navbar__link" href="/optimus/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/optimus/blog">Blog</a><a class="navbar__item navbar__link" href="/optimus/help">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link"></a><a href="https://github.com/odpf/optimus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-item-github"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>simplify_plugin_maintenance</h1></header><ul><li>Feature Name: Simplify Plugins</li><li>Status: Draft</li><li>Start Date: 2022-05-07</li><li>Author: Saikumar</li></ul><h1>Summary</h1><p>The scope of this rfc is to simplify the release and deployment operations w.r.t the optimus plugin ecosystem.</p><p>The proposal here is to :</p><ol><li><strong>Avoid Wrapping Executor Images</strong> :<br>Decouple the executor_boot_process and the executor as separate containers where the airflow worker launches a pod with init-container (for boot process) adjacent to executor container.</li><li><strong>Simplfy Plugin Installation</strong> :<ul><li><code>Server end</code> : Install plugins declaratively at runtime instead of manually baking them into the optimus server image (in kubernetes setup).</li><li><code>Client end</code> : Plugin interface for client-end is limited to support  Version, Survey Questions and Answers etc. that can be extracted out from the current plugin interface and maintained as yaml file which simplifies platform dependent plugin distribution for cli.</li></ul></li></ol><h1>Technical Design</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="background-">Background :<a href="#background-" class="hash-link" aria-label="Direct link to Background :" title="Direct link to Background :">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="changes-that-trigger-a-new-release-in-optimus-setup">Changes that trigger a new release in Optimus setup:<a href="#changes-that-trigger-a-new-release-in-optimus-setup" class="hash-link" aria-label="Direct link to Changes that trigger a new release in Optimus setup:" title="Direct link to Changes that trigger a new release in Optimus setup:">​</a></h3><ul><li>Executor Image changes</li><li>Executor Image Wrapper changes</li><li>Plugin binary changes</li><li>Optimus binary changes</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="release-dependencies-as-per-current-design">Release dependencies as per current design<a href="#release-dependencies-as-per-current-design" class="hash-link" aria-label="Direct link to Release dependencies as per current design" title="Direct link to Release dependencies as per current design">​</a></h3><ul><li><code>Executor Image release</code> -&gt; <code>Executor Wrapper Image release</code> -&gt; <code>Plugin binary release</code> -&gt; <code>Server release</code></li><li><code>Plugin binary release</code> -&gt; <code>Server release</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-avoid-wrapping-executor-images--">1. <u>Avoid Wrapping Executor Images</u>  :<a href="#1-avoid-wrapping-executor-images--" class="hash-link" aria-label="Direct link to 1-avoid-wrapping-executor-images--" title="Direct link to 1-avoid-wrapping-executor-images--">​</a></h3><ul><li>The <code>executor_boot_process</code> and <code>executor</code> are coupled:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Plugin repo structure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/task/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/task/Dockerfile           -- task_image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/task/executor/Dockerfile  -- executor_image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Executor Wrapper Image (Task Image) :</p><ul><li>It&#x27;s a wrapper around the executor_image to facilitate boot mechanism for executor.</li><li>The optimus binary is downloaded during buildtime of this image.</li><li>During runtime, it does as follow :<ul><li>Fetch assets, secrets, env from optimus server.</li><li>Load the env and launches the executor process.</li></ul></li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">task_image </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | executor_image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | optimus-bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | entrypoint.sh (load assets, env and launch executor)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>optimus-bin</code> and <code>entrypoint.sh</code> are baked into the <code>task_image</code> and is being maintained by task/plugin developers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-simplify-plugin-installation-">2. <u>Simplify Plugin Installation</u> :<a href="#2-simplify-plugin-installation-" class="hash-link" aria-label="Direct link to 2-simplify-plugin-installation-" title="Direct link to 2-simplify-plugin-installation-">​</a></h3><ul><li>Plugin binaries are manually installed (baked into optimus image in kubernetes setup). </li><li>Any change in plugin code demands re-creation of optimus image with new plugin binary, inturn demanding redeployment of optimus server. (in kubernetes setup)</li><li>At client side, plugin binaries require support for different platforms.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="approach-">Approach :<a href="#approach-" class="hash-link" aria-label="Direct link to Approach :" title="Direct link to Approach :">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-avoid-wrapping-executor-images---1">1. <u>Avoid Wrapping Executor Images </u> :<a href="#1-avoid-wrapping-executor-images---1" class="hash-link" aria-label="Direct link to 1-avoid-wrapping-executor-images---1" title="Direct link to 1-avoid-wrapping-executor-images---1">​</a></h3><ul><li>Decouple the lifecycle of the executor and the boot process as seperate containers/images.</li></ul><img loading="lazy" src="images/simplify_plugins_executor.png" alt="Simplify Plugins Executor" width="800" class="img_ev3q"><p><strong>Task Boot Sequence</strong>:</p><ol><li>Airflow worker fetches env and secrets for the job and adds them to the executor pod as environment variables.</li><li>KubernetesPodOperator spawns init-container and executor-container, mounted with shared volume (type emptyDir) for assets.</li><li><code>init-container</code> fetches assets, config, env files and writes onto the shared volume.</li><li>the default entrypoint in the executor-image starts the actual job.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-simplify-plugin-installations-">2. <u>Simplify Plugin Installations</u> :<a href="#2-simplify-plugin-installations-" class="hash-link" aria-label="Direct link to 2-simplify-plugin-installations-" title="Direct link to 2-simplify-plugin-installations-">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="a-plugin-manager">A) Plugin Manager:<a href="#a-plugin-manager" class="hash-link" aria-label="Direct link to A) Plugin Manager:" title="Direct link to A) Plugin Manager:">​</a></h4><ul><li>Currently the plugins are maintained as monorepo and versioned together. For any change in a single plugin, a new tar file containing all plugin binaries is created and released.</li><li>A plugin manager is required to support declarative installation of plugins so that plugins can be independently versioned, packaged and installed.</li><li>This plugin manager consumes a config (plugins_config) and downloads artifacts from a plugin repository.</li></ul><ul><li>Optimus support for plugin manager as below.<ul><li><code>optimus plugin install -c config.yaml</code> -- at server</li></ul></li><li>Support for different kinds of plugin repositories (like s3, gcs, url, local file system etc..) gives the added flexibility and options to distribute and install the plugin binaries in different ways.</li><li>Plugins are installed at container runtime and this decouples the building of optimus docker image from plugins installations.</li><li>Example for the plugin_config: </li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">plugin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .plugins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># local filesystem for dev</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ../transformers/dist/bq2bq_darwin_arm64/optimus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bq2bq_darwin_arm64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># any http uri</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//github.com/odpf/optimus/releases/download/v0.2.5/optimus_0.2.5_linux_arm64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="b-yaml-plugin-interface-for-client-side-simplification">B) Yaml Plugin Interface: (for client side simplification)<a href="#b-yaml-plugin-interface-for-client-side-simplification" class="hash-link" aria-label="Direct link to B) Yaml Plugin Interface: (for client side simplification)" title="Direct link to B) Yaml Plugin Interface: (for client side simplification)">​</a></h4><ul><li>Currently plugins are implemented and distributed as binaries and as clients needs to install them, it demands support for different host  architectures.</li><li>Since CLI (client side) plugins just require details about plugin such as Version, Suevery Questions etc. the proposal here is to maintain CLI plugins as yaml files.</li><li>Implementation wise, the proposal here is to split the current plugin interface (which only supports interaction with binary plugins) to also accommodate yaml based plugins.</li><li>The above mentioned pluign manager, at server end, would be agnostic about the contents of plugin artifacts from the repository.</li><li>At client side, the CLI could sync the yaml files from the server to stay up-to-date with the server w.r.t plugins.</li><li>At this point, we have the scope to move away from binary plugins except for bq2bq plugin due to its depdendency on <code>ComplileAsset</code> and <code>ResolveDependency</code> functionalities which are required at server end (not at cli).</li><li>Handling Bq2Bq plugin:<ul><li>Move <code>CompileAsset</code> functionality as a part of Bq2bq executor.</li><li>Move  <code>ResolveDependency</code> functionality to optimus core which should support dependecy-resolution on standard-sql</li></ul></li><li>Meanwhile the Bq2bq plugin is handled, the plugin interface can be maintanined in such a way that it also supports binary plugin in addition to yaml (as backward compaitbility feature).</li><li>The plugin discovery logic should be to load binary if present, else load yaml file; for a single plugin.</li><li>Now that we have yaml files at server, CLI can sync only the yaml files from the server.<ul><li><code>optimus plugin sync -c optimus.yaml</code></li></ul></li></ul><ul><li>Example representation of the yaml plugin : </li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bq2bq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BigQuery to BigQuery transformation task</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">plugintype</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> task</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">pluginmods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dependencyresolver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">pluginversion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.1.0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">SNAPSHOT</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">27cb56f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiversion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker.io/odpf/optimus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bq2bq</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0.1.0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">SNAPSHOT</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">27cb56f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">secretpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/auth.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dependson</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">hooktype</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">questions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PROJECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prompt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Project ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">help</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Destination bigquery project ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zA</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9_\</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">validationerror</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> invalid name (can only contain characters A</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z (in either case)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hyphen(</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">) or underscore (_)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minlength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dataset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prompt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dataset Name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">help</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Destination bigquery dataset ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zA</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9_\</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">validationerror</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> invalid name (can only contain characters A</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z (in either case)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hyphen(</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">) or underscore (_)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minlength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prompt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Table ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">help</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Destination bigquery table ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zA</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9_</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">validationerror</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> invalid table name (can only contain characters A</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z (in either case)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hyphen(</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">) or underscore (_)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minlength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxlength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LOAD_METHOD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prompt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Load method to use on destination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">help</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      APPEND        - Append to existing table</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      REPLACE       - Deletes existing partition and insert result of select query</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      MERGE         - DML statements, BQ scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      REPLACE_MERGE - [Experimental] Advanced replace using merge query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> APPEND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">multiselect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> APPEND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REPLACE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> MERGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REPLACE_MERGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REPLACE_ALL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">defaultassets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> query.sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      -- SQL query goes here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Select * from &quot;project.dataset.table&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="result">Result:<a href="#result" class="hash-link" aria-label="Direct link to Result:" title="Direct link to Result:">​</a></h2><img loading="lazy" src="images/simplify_plugins.png" alt="Simplify Plugins" width="800" class="img_ev3q"><ul><li>Executor boot process is standardised and extracted away from plugin developers. Now any arbitrary image can be used for executors.</li><li>At server side, for changes in plugin (dur to plugin release), update the plugin_manager_config and restart the optimus server pod. The plugin manager is expected to reinstall the plugins.</li><li>Client side dependency on plugins is simplified with yaml based plugins.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/odpf/optimus/edit/master/docs/docs/rfcs/20220507_simplify_plugin_maintenance.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-03-29T21:36:52.000Z">Mar 29, 2023</time></b> by <b>Arinda Arif</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background-" class="table-of-contents__link toc-highlight">Background :</a><ul><li><a href="#changes-that-trigger-a-new-release-in-optimus-setup" class="table-of-contents__link toc-highlight">Changes that trigger a new release in Optimus setup:</a></li><li><a href="#release-dependencies-as-per-current-design" class="table-of-contents__link toc-highlight">Release dependencies as per current design</a></li><li><a href="#1-avoid-wrapping-executor-images--" class="table-of-contents__link toc-highlight">1. <u>Avoid Wrapping Executor Images</u>  :</a></li><li><a href="#2-simplify-plugin-installation-" class="table-of-contents__link toc-highlight">2. <u>Simplify Plugin Installation</u> :</a></li></ul></li><li><a href="#approach-" class="table-of-contents__link toc-highlight">Approach :</a><ul><li><a href="#1-avoid-wrapping-executor-images---1" class="table-of-contents__link toc-highlight">1. <u>Avoid Wrapping Executor Images </u> :</a></li><li><a href="#2-simplify-plugin-installations-" class="table-of-contents__link toc-highlight">2. <u>Simplify Plugin Installations</u> :</a></li></ul></li><li><a href="#result" class="table-of-contents__link toc-highlight">Result:</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Products</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/odpf/meteor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Meteor<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/odpf/firehose" target="_blank" rel="noopener noreferrer" class="footer__link-item">Firehose<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/odpf/raccoon" target="_blank" rel="noopener noreferrer" class="footer__link-item">Raccoon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://odpf.github.io/dagger/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dagger<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/optimus/docs/introduction">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/optimus/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/optimus/help">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/odpf/optimus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2020-2023 ODPF</div></div></div></footer></div>
<script src="/optimus/assets/js/runtime~main.35534b05.js"></script>
<script src="/optimus/assets/js/main.0c2553fe.js"></script>
</body>
</html>