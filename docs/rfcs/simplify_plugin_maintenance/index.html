<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/optimus/blog/rss.xml" title="Optimus Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/optimus/blog/atom.xml" title="Optimus Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RSCK0YREFM"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RSCK0YREFM",{})</script><title data-react-helmet="true">simplify_plugin_maintenance | Optimus</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://odpf.github.io/optimus/docs/rfcs/simplify_plugin_maintenance"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="simplify_plugin_maintenance | Optimus"><meta data-react-helmet="true" name="description" content="- Feature Name: Simplify Plugins"><meta data-react-helmet="true" property="og:description" content="- Feature Name: Simplify Plugins"><link data-react-helmet="true" rel="shortcut icon" href="/optimus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://odpf.github.io/optimus/docs/rfcs/simplify_plugin_maintenance"><link data-react-helmet="true" rel="alternate" href="https://odpf.github.io/optimus/docs/rfcs/simplify_plugin_maintenance" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://odpf.github.io/optimus/docs/rfcs/simplify_plugin_maintenance" hreflang="x-default"><link rel="stylesheet" href="/optimus/assets/css/styles.7914c5d7.css">
<link rel="preload" href="/optimus/assets/js/runtime~main.c074d2de.js" as="script">
<link rel="preload" href="/optimus/assets/js/main.40830ef5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#222;color:#eee" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">⭐️ If you like Optimus, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/odpf/optimus">GitHub</a>! ⭐</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/optimus/"><img src="/optimus/img/logo.svg" alt="Optimus" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/optimus/img/logo.svg" alt="Optimus" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Optimus</b></a><a class="navbar__item navbar__link" href="/optimus/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/optimus/blog">Blog</a><a class="navbar__item navbar__link" href="/optimus/help">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link"></a><a href="https://github.com/odpf/optimus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-item-github"></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">☾</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">☀️</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>simplify_plugin_maintenance</h1></header><ul><li>Feature Name: Simplify Plugins</li><li>Status: Draft</li><li>Start Date: 2022-05-07</li><li>Author: Saikumar</li></ul><header><h1>Summary</h1></header><p>The scope of this rfc is to simplify the release and deployment operations w.r.t the optimus plugin ecosystem.</p><p>The proposal here is to :</p><ol><li><strong>Avoid Wrapping Executor Images</strong> :<br>Decouple the executor_boot_process and the executor as separate containers where the airflow worker launches a pod with init-container (for boot process) adjacent to executor container.</li><li><strong>Simplfy Plugin Installation</strong> :<ul><li><code>Server end</code> : Install plugins declaratively at runtime instead of manually baking them into the optimus server image (in kubernetes setup).</li><li><code>Client end</code> : Plugin interface for client-end is limited to support  Version, Survey Questions and Answers etc. that can be extracted out from the current plugin interface and maintained as yaml file which simplifies platform dependent plugin distribution for cli.</li></ul></li></ol><header><h1>Technical Design</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="background-"></a>Background :<a class="hash-link" href="#background-" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="changes-that-trigger-a-new-release-in-optimus-setup"></a>Changes that trigger a new release in Optimus setup:<a class="hash-link" href="#changes-that-trigger-a-new-release-in-optimus-setup" title="Direct link to heading">#</a></h3><ul><li>Executor Image changes</li><li>Executor Image Wrapper changes</li><li>Plugin binary changes</li><li>Optimus binary changes</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="release-dependencies-as-per-current-design"></a>Release dependencies as per current design<a class="hash-link" href="#release-dependencies-as-per-current-design" title="Direct link to heading">#</a></h3><ul><li><code>Executor Image release</code> -&gt; <code>Executor Wrapper Image release</code> -&gt; <code>Plugin binary release</code> -&gt; <code>Server release</code></li><li><code>Plugin binary release</code> -&gt; <code>Server release</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-avoid-wrapping-executor-images--"></a>1. <u>Avoid Wrapping Executor Images</u>  :<a class="hash-link" href="#1-avoid-wrapping-executor-images--" title="Direct link to heading">#</a></h3><ul><li>The <code>executor_boot_process</code> and <code>executor</code> are coupled:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">-- Plugin repo structure</span></span><span class="token-line" style="color:#393A34"><span class="token plain">/task/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">/task/Dockerfile           -- task_image</span></span><span class="token-line" style="color:#393A34"><span class="token plain">/task/executor/Dockerfile  -- executor_image</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Executor Wrapper Image (Task Image) :</p><ul><li>It&#x27;s a wrapper around the executor_image to facilitate boot mechanism for executor.</li><li>The optimus binary is downloaded during buildtime of this image.</li><li>During runtime, it does as follow :<ul><li>Fetch assets, secrets, env from optimus server.</li><li>Load the env and launches the executor process.</li></ul></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">task_image </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    | executor_image</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    | optimus-bin</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    | entrypoint.sh (load assets, env and launch executor)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>optimus-bin</code> and <code>entrypoint.sh</code> are baked into the <code>task_image</code> and is being maintained by task/plugin developers.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-simplify-plugin-installation-"></a>2. <u>Simplify Plugin Installation</u> :<a class="hash-link" href="#2-simplify-plugin-installation-" title="Direct link to heading">#</a></h3><ul><li>Plugin binaries are manually installed (baked into optimus image in kubernetes setup). </li><li>Any change in plugin code demands re-creation of optimus image with new plugin binary, inturn demanding redeployment of optimus server. (in kubernetes setup)</li><li>At client side, plugin binaries require support for different platforms.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="approach-"></a>Approach :<a class="hash-link" href="#approach-" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-avoid-wrapping-executor-images---1"></a>1. <u>Avoid Wrapping Executor Images </u> :<a class="hash-link" href="#1-avoid-wrapping-executor-images---1" title="Direct link to heading">#</a></h3><ul><li>Decouple the lifecycle of the executor and the boot process as seperate containers/images.</li></ul><img src="images/simplify_plugins_executor.png" alt="Simplify Plugins Executor" width="800"><p><strong>Task Boot Sequence</strong>:</p><ol><li>Airflow worker fetches env and secrets for the job and adds them to the executor pod as environment variables.</li><li>KubernetesPodOperator spawns init-container and executor-container, mounted with shared volume (type emptyDir) for assets.</li><li><code>init-container</code> fetches assets, config, env files and writes onto the shared volume.</li><li>the default entrypoint in the executor-image starts the actual job.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-simplify-plugin-installations-"></a>2. <u>Simplify Plugin Installations</u> :<a class="hash-link" href="#2-simplify-plugin-installations-" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="a-plugin-manager"></a>A) Plugin Manager:<a class="hash-link" href="#a-plugin-manager" title="Direct link to heading">#</a></h4><ul><li>Currently the plugins are maintained as monorepo and versioned together. For any change in a single plugin, a new tar file containing all plugin binaries is created and released.</li><li>A plugin manager is required to support declarative installation of plugins so that plugins can be independently versioned, packaged and installed.</li><li>This plugin manager consumes a config (plugins_config) and downloads artifacts from a plugin repository.</li></ul><ul><li>Optimus support for plugin manager as below.<ul><li><code>optimus plugin install -c config.yaml</code> -- at server</li></ul></li><li>Support for different kinds of plugin repositories (like s3, gcs, url, local file system etc..) gives the added flexibility and options to distribute and install the plugin binaries in different ways.</li><li>Plugins are installed at container runtime and this decouples the building of optimus docker image from plugins installations.</li><li>Example for the plugin_config: </li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">plugin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .plugins</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># local filesystem for dev</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ../transformers/dist/bq2bq_darwin_arm64/optimus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bq2bq_darwin_arm64</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># any http uri</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//github.com/odpf/optimus/releases/download/v0.2.5/optimus_0.2.5_linux_arm64.tar.gz</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="b-yaml-plugin-interface-for-client-side-simplification"></a>B) Yaml Plugin Interface: (for client side simplification)<a class="hash-link" href="#b-yaml-plugin-interface-for-client-side-simplification" title="Direct link to heading">#</a></h4><ul><li>Currently plugins are implemented and distributed as binaries and as clients needs to install them, it demands support for different host  architectures.</li><li>Since CLI (client side) plugins just require details about plugin such as Version, Suevery Questions etc. the proposal here is to maintain CLI plugins as yaml files.</li><li>Implementation wise, the proposal here is to split the current plugin interface (which only supports interaction with binary plugins) to also accommodate yaml based plugins.</li><li>The above mentioned pluign manager, at server end, would be agnostic about the contents of plugin artifacts from the repository.</li><li>At client side, the CLI could sync the yaml files from the server to stay up-to-date with the server w.r.t plugins.</li><li>At this point, we have the scope to move away from binary plugins except for bq2bq plugin due to its depdendency on <code>ComplileAsset</code> and <code>ResolveDependency</code> functionalities which are required at server end (not at cli).</li><li>Handling Bq2Bq plugin:<ul><li>Move <code>CompileAsset</code> functionality as a part of Bq2bq executor.</li><li>Move  <code>ResolveDependency</code> functionality to optimus core which should support dependecy-resolution on standard-sql</li></ul></li><li>Meanwhile the Bq2bq plugin is handled, the plugin interface can be maintanined in such a way that it also supports binary plugin in addition to yaml (as backward compaitbility feature).</li><li>The plugin discovery logic should be to load binary if present, else load yaml file; for a single plugin.</li><li>Now that we have yaml files at server, CLI can sync only the yaml files from the server.<ul><li><code>optimus plugin sync -c optimus.yaml</code></li></ul></li></ul><ul><li>Example representation of the yaml plugin : </li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bq2bq</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BigQuery to BigQuery transformation task</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">plugintype</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> task</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">pluginmods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> cli</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> dependencyresolver</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">pluginversion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.1.0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">SNAPSHOT</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">27cb56f</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiversion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> docker.io/odpf/optimus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">task</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">bq2bq</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0.1.0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">SNAPSHOT</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">27cb56f</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">secretpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/auth.json</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">dependson</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">hooktype</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">questions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PROJECT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prompt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Project ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">help</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Destination bigquery project ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zA</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9_\</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+$</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">validationerror</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> invalid name (can only contain characters A</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z (in either case)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hyphen(</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">) or underscore (_)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minlength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dataset</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prompt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Dataset Name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">help</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Destination bigquery dataset ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zA</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9_\</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+$</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">validationerror</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> invalid name (can only contain characters A</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z (in either case)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hyphen(</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">) or underscore (_)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minlength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TABLE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prompt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Table ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">help</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Destination bigquery table ID</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">regexp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ^</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">zA</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9_</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+$</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">validationerror</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> invalid table name (can only contain characters A</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Z (in either case)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 0</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hyphen(</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">) or underscore (_)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">minlength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxlength</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LOAD_METHOD</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">prompt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Load method to use on destination</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">help</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      APPEND        - Append to existing table</span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      REPLACE       - Deletes existing partition and insert result of select query</span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      MERGE         - DML statements, BQ scripts</span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      REPLACE_MERGE - [Experimental] Advanced replace using merge query</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> APPEND</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">multiselect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> APPEND</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REPLACE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> MERGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REPLACE_MERGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> REPLACE_ALL</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">defaultassets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> query.sql</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      -- SQL query goes here</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      Select * from &quot;project.dataset.table&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="result"></a>Result:<a class="hash-link" href="#result" title="Direct link to heading">#</a></h2><img src="images/simplify_plugins.png" alt="Simplify Plugins" width="800"><ul><li>Executor boot process is standardised and extracted away from plugin developers. Now any arbitrary image can be used for executors.</li><li>At server side, for changes in plugin (dur to plugin release), update the plugin_manager_config and restart the optimus server pod. The plugin manager is expected to reinstall the plugins.</li><li>Client side dependency on plugins is simplified with yaml based plugins.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/odpf/optimus/edit/master/docs/docs/rfcs/20220507_simplify_plugin_maintenance.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"><span class="theme-last-updated">Last updated on <b><time datetime="2023-01-12T08:19:48.000Z">1/12/2023</time></b> by <b>Sandeep Bhardwaj</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background-" class="table-of-contents__link">Background :</a><ul><li><a href="#changes-that-trigger-a-new-release-in-optimus-setup" class="table-of-contents__link">Changes that trigger a new release in Optimus setup:</a></li><li><a href="#release-dependencies-as-per-current-design" class="table-of-contents__link">Release dependencies as per current design</a></li><li><a href="#1-avoid-wrapping-executor-images--" class="table-of-contents__link">1. <u>Avoid Wrapping Executor Images</u>  :</a></li><li><a href="#2-simplify-plugin-installation-" class="table-of-contents__link">2. <u>Simplify Plugin Installation</u> :</a></li></ul></li><li><a href="#approach-" class="table-of-contents__link">Approach :</a><ul><li><a href="#1-avoid-wrapping-executor-images---1" class="table-of-contents__link">1. <u>Avoid Wrapping Executor Images </u> :</a></li><li><a href="#2-simplify-plugin-installations-" class="table-of-contents__link">2. <u>Simplify Plugin Installations</u> :</a></li></ul></li><li><a href="#result" class="table-of-contents__link">Result:</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Products</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/odpf/meteor" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Meteor<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/odpf/firehose" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Firehose<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/odpf/raccoon" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Raccoon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://odpf.github.io/dagger/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Dagger<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/optimus/docs/introduction">Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/optimus/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/optimus/help">Help</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://bit.ly/2RzPbtn" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/odpf/optimus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2020-2023 ODPF</div></div></div></footer></div>
<script src="/optimus/assets/js/runtime~main.c074d2de.js"></script>
<script src="/optimus/assets/js/main.40830ef5.js"></script>
</body>
</html>